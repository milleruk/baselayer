{% extends "base.html" %}
{% block title %}Admin - Challenges{% endblock %}
{% block page_title %}Challenge Management{% endblock %}

{% block content %}
<div class="mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
  <div>
    <h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Challenge Management</h1>
    <p class="text-gray-600 dark:text-gray-400">Manage challenges, dates, and available plan templates</p>
  </div>
  <a href="{% url 'tracker:admin_challenge_create' %}" class="px-4 py-2 text-sm font-medium text-white bg-primary hover:bg-primary-dark rounded-lg transition-colors">
    + Create Challenge
  </a>
</div>

<!-- Status Filter -->
<div class="mb-6 flex flex-wrap gap-2">
  <a href="?status=all" class="px-3 py-1.5 text-xs font-medium rounded-lg transition-colors {% if status_filter == 'all' %}text-white bg-primary{% else %}text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700{% endif %}">
    All
  </a>
  <a href="?status=active" class="px-3 py-1.5 text-xs font-medium rounded-lg transition-colors {% if status_filter == 'active' %}text-white bg-primary{% else %}text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700{% endif %}">
    Active
  </a>
  <a href="?status=upcoming" class="px-3 py-1.5 text-xs font-medium rounded-lg transition-colors {% if status_filter == 'upcoming' %}text-white bg-primary{% else %}text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700{% endif %}">
    Upcoming
  </a>
  <a href="?status=running" class="px-3 py-1.5 text-xs font-medium rounded-lg transition-colors {% if status_filter == 'running' %}text-white bg-primary{% else %}text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700{% endif %}">
    Running
  </a>
  <a href="?status=past" class="px-3 py-1.5 text-xs font-medium rounded-lg transition-colors {% if status_filter == 'past' %}text-white bg-primary{% else %}text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700{% endif %}">
    Past
  </a>
  <a href="?status=inactive" class="px-3 py-1.5 text-xs font-medium rounded-lg transition-colors {% if status_filter == 'inactive' %}text-white bg-primary{% else %}text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700{% endif %}">
    Inactive
  </a>
</div>

{% if challenges %}
<div class="rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 shadow-sm overflow-hidden">
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
      <thead class="bg-gray-50 dark:bg-gray-700">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Name</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Type</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Dates & Signup</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Templates</th>
          <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
        </tr>
      </thead>
      <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
        {% for challenge in challenges %}
        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
          <td class="px-6 py-4">
            <div class="font-bold text-primary mb-1">{{ challenge.name }}</div>
            {% if challenge.description %}
              <div class="text-sm text-gray-600 dark:text-gray-400">{{ challenge.description|truncatewords:15 }}</div>
            {% endif %}
          </td>
          <td class="px-6 py-4">
            <span class="px-2 py-1 text-xs font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded">
              {{ challenge.get_challenge_type_display }}
            </span>
          </td>
          <td class="px-6 py-4">
            <div class="text-sm text-gray-900 dark:text-white">{{ challenge.start_date|date:"M d" }} - {{ challenge.end_date|date:"M d, Y" }}</div>
            {% if challenge.signup_opens_date %}
              <div class="text-xs text-primary mt-1">Opens: {{ challenge.signup_opens_date|date:"M d" }}</div>
            {% endif %}
            {% if challenge.signup_deadline %}
              <div class="text-xs text-gray-500 dark:text-gray-500 mt-1">Closes: {{ challenge.signup_deadline|date:"M d" }}</div>
            {% endif %}
          </td>
          <td class="px-6 py-4">
            {% if challenge.is_active %}
              {% if challenge.is_currently_running %}
                <span class="px-2 py-1 text-xs font-semibold text-red-800 dark:text-red-200 bg-red-100 dark:bg-red-900/30 rounded">Running</span>
              {% elif challenge.has_ended %}
                <span class="px-2 py-1 text-xs font-semibold text-blue-800 dark:text-blue-200 bg-blue-100 dark:bg-blue-900/30 rounded">Ended</span>
              {% else %}
                <span class="px-2 py-1 text-xs font-semibold text-green-800 dark:text-green-200 bg-green-100 dark:bg-green-900/30 rounded">Upcoming</span>
              {% endif %}
            {% else %}
              <span class="px-2 py-1 text-xs font-semibold text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded">Inactive</span>
            {% endif %}
            {% if not challenge.is_visible %}
              <div class="text-xs text-gray-500 dark:text-gray-500 mt-1">Hidden</div>
            {% endif %}
          </td>
          <td class="px-6 py-4">
            <div class="text-sm text-gray-900 dark:text-white">
              {{ challenge.available_templates.count }} template{{ challenge.available_templates.count|pluralize }}
            </div>
            {% if challenge.default_template %}
              <div class="text-xs text-gray-500 dark:text-gray-500 mt-1">
                Default: {{ challenge.default_template.name }}
              </div>
            {% endif %}
          </td>
          <td class="px-6 py-4 text-right">
            <div class="flex gap-2 justify-end flex-wrap">
              {% if challenge.available_templates.exists %}
                <a href="{% url 'tracker:admin_assign_workouts' challenge.id %}" class="px-3 py-1.5 text-xs font-medium text-blue-700 dark:text-blue-300 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors" title="Assign Peloton workouts">
                  ðŸš´ Workouts
                </a>
              {% endif %}
              <a href="{% url 'tracker:admin_challenge_edit' challenge.id %}" class="px-3 py-1.5 text-xs font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                Edit
              </a>
              <a href="{% url 'tracker:admin_challenge_delete' challenge.id %}" class="px-3 py-1.5 text-xs font-medium text-red-700 dark:text-red-300 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors">
                Delete
              </a>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% else %}
<div class="rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-12 text-center">
  <div class="text-5xl mb-4">ðŸ“‹</div>
  <p class="text-lg text-gray-600 dark:text-gray-400 mb-6">No challenges found.</p>
  <a href="{% url 'tracker:admin_challenge_create' %}" class="inline-flex items-center px-6 py-3 text-sm font-medium text-white bg-primary hover:bg-primary-dark rounded-lg transition-colors">
    Create First Challenge
  </a>
</div>
{% endif %}
{% endblock %}
