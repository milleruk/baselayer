{% extends "base.html" %}
{% block title %}Workout History{% endblock %}
{% block page_title %}Workout History{% endblock %}

{% block content %}
<div class="mb-6">
  <h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Workout History</h1>
  <p class="text-gray-600 dark:text-gray-400">Your complete training log synchronized with Peloton.</p>
</div>

<!-- Peloton Connection Status -->
{% if peloton_connection %}
  <div class="rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-6 shadow-sm mb-6">
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
      <div class="flex items-start gap-4">
        <div class="w-3 h-3 rounded-full mt-1 {% if peloton_connection.is_connected %}bg-green-500{% else %}bg-gray-400{% endif %}"></div>
        <div>
          <div class="font-semibold text-gray-900 dark:text-white mb-1">
            {% if peloton_connection.is_connected %}
              Connected to Peloton
            {% else %}
              Not Connected to Peloton
            {% endif %}
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-400">
            {% if peloton_connection.is_connected %}
              Connected as {{ peloton_connection.peloton_username|default:"User" }}. Your workouts are ready to sync.
            {% else %}
              Connect your Peloton account to sync your workout history.
            {% endif %}
          </div>
          {% if peloton_connection.last_sync_at %}
            <div class="text-xs text-gray-500 dark:text-gray-500 mt-1">
              Last sync: {{ peloton_connection.last_sync_at|date:"d/m/Y" }}
            </div>
          {% endif %}
        </div>
      </div>
      <form method="post" action="{% url 'workouts:sync' %}">
        {% csrf_token %}
        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-primary hover:bg-primary-dark rounded-lg transition-colors {% if not peloton_connection.is_connected %}opacity-50 cursor-not-allowed{% endif %}" {% if not peloton_connection.is_connected %}disabled{% endif %}>
          Sync Workouts
        </button>
      </form>
    </div>
  </div>
{% else %}
  <div class="rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-6 shadow-sm mb-6">
    <div class="flex items-center justify-between gap-4">
      <div class="flex items-center gap-4">
        <div class="w-3 h-3 rounded-full bg-gray-400"></div>
        <div>
          <div class="font-semibold text-gray-900 dark:text-white mb-1">Not Connected to Peloton</div>
          <div class="text-sm text-gray-600 dark:text-gray-400">Connect your Peloton account to sync your workout history.</div>
        </div>
      </div>
      <a href="{% url 'workouts:connect' %}" class="px-4 py-2 text-sm font-medium text-white bg-primary hover:bg-primary-dark rounded-lg transition-colors">
        Connect Peloton
      </a>
    </div>
  </div>
{% endif %}

<!-- Workout List -->
{% if workouts %}
  <div class="rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 shadow-sm overflow-hidden">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
        <thead class="bg-gray-50 dark:bg-gray-700">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Date</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Workout</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Type</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Duration</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
          {% for workout in workouts %}
            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                {{ workout.completed_date|date:"M d, Y" }}
              </td>
              <td class="px-6 py-4 text-sm">
                <a href="{% url 'workouts:detail' workout.id %}" class="font-medium text-primary hover:text-primary-dark">
                  {{ workout.title }}
                </a>
                {% if workout.instructor %}
                  <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">{{ workout.instructor.name }}</div>
                {% endif %}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="px-2 py-1 text-xs font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded">
                  {{ workout.workout_type.name }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                {{ workout.duration_minutes }}min
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                {% if workout.peloton_url %}
                  <a href="{{ workout.peloton_url }}" target="_blank" rel="noopener noreferrer" class="text-primary hover:text-primary-dark">
                    View ‚Üó
                  </a>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  
  <!-- Pagination -->
  {% if is_paginated %}
    <div class="mt-6 flex justify-center">
      <nav class="flex gap-2">
        {% if page_obj.has_previous %}
          <a href="?page={{ page_obj.previous_page_number }}" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
            Previous
          </a>
        {% endif %}
        <span class="px-4 py-2 text-sm font-medium text-gray-900 dark:text-white">
          Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </span>
        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
            Next
          </a>
        {% endif %}
      </nav>
    </div>
  {% endif %}
{% else %}
  <div class="rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-12 text-center">
    <div class="text-5xl mb-4">üèãÔ∏è</div>
    <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">No workouts yet</h3>
    <p class="text-gray-600 dark:text-gray-400 mb-6">Connect your Peloton account to sync your workout history.</p>
    {% if not peloton_connection or not peloton_connection.is_connected %}
      <a href="{% url 'workouts:connect' %}" class="inline-flex items-center px-6 py-3 text-sm font-medium text-white bg-primary hover:bg-primary-dark rounded-lg transition-colors">
        Connect Peloton
      </a>
    {% endif %}
  </div>
{% endif %}
{% endblock %}
