{% extends "accounts/wizard/base.html" %}

{% block title %}Stage 4: Performance Metrics | Chase The Zones{% endblock %}

{% block content %}
<div>
  <div class="mb-4">
    {% if sport_index|add:"0" > 0 %}
      <a href="{% url 'wizard_stage_4' %}?sport_index={{ sport_index|add:"-1" }}" class="inline-flex items-center text-sm text-gray-500 transition-colors hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
        <svg class="stroke-current mr-2" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none">
          <path d="M12.7083 5L7.5 10.2083L12.7083 15.4167" stroke="" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
        Back to Previous Sport
      </a>
    {% else %}
      <a href="{% url 'wizard_stage_3' %}" class="inline-flex items-center text-sm text-gray-500 transition-colors hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
        <svg class="stroke-current mr-2" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none">
          <path d="M12.7083 5L7.5 10.2083L12.7083 15.4167" stroke="" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
        Back to Sports
      </a>
    {% endif %}
  </div>

  <div class="mb-8">
    <h1 class="mb-2 font-semibold text-gray-800 text-title-sm dark:text-white/90 sm:text-title-md">
      {% if current_sport == "Cycling" %}
        What's Your FTP?
      {% else %}
        What's Your {{ current_sport }} Pace Level?
      {% endif %}
    </h1>
    <p class="text-sm text-gray-500 dark:text-gray-400">
      {% if current_sport == "Cycling" %}
        Enter your Functional Threshold Power (FTP) in watts. This helps us calculate your power zones.
        <br class="hidden sm:block">
        <span class="text-xs mt-2 block">Not sure? A typical cyclist's FTP ranges from 150-400W.</span>
      {% else %}
        Select your {{ current_sport|lower }} pace level (1-10). This helps us calculate your pace zones.
        <br class="hidden sm:block">
        <span class="text-xs mt-2 block">1 = Slow/Recovery, 10 = Maximum Effort</span>
      {% endif %}
    </p>
  </div>

  <form method="post" class="space-y-5">
    {% csrf_token %}
    
    {% if current_sport == "Cycling" %}
      <!-- FTP Form -->
      <div>
        <label for="{{ form.current_ftp.id_for_label }}" class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400">
          FTP in Watts <span class="text-error-500">*</span>
        </label>
        <input
          type="number"
          id="{{ form.current_ftp.id_for_label }}"
          name="{{ form.current_ftp.name }}"
          placeholder="e.g., 250"
          value="{{ form.current_ftp.value|default:200 }}"
          required
          min="50"
          max="500"
          class="dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"
        />
        {% if form.current_ftp.errors %}
          <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.current_ftp.errors.0 }}</p>
        {% endif %}
      </div>

      <!-- Backdated Checkbox -->
      <div>
        <label class="flex items-center gap-3 cursor-pointer group">
          <input
            type="checkbox"
            name="{{ form.add_backdated.name }}"
            value="on"
            class="w-5 h-5 rounded text-primary bg-gray-100 dark:bg-gray-800 border-gray-300 dark:border-gray-600 focus:ring-primary"
            {% if form.add_backdated.value %}checked{% endif %}
          />
          <span class="text-sm font-medium text-gray-700 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white transition-colors">
            Add historical FTP entries
          </span>
          <span class="text-xs text-gray-500">
            <svg class="w-4 h-4 inline-block" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
            </svg>
            Back-dated data helps with historical charts
          </span>
        </label>
      </div>
    {% else %}
      <!-- Pace Form for Running/Walking (activity-specific) -->
      <div>
        <label for="{{ form.pace_level.id_for_label }}" class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400">
          Pace Level (1-10) <span class="text-error-500">*</span>
        </label>
        <select
          id="{{ form.pace_level.id_for_label }}"
          name="{{ form.pace_level.name }}"
          required
          class="dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"
        >
          {% for level_value, level_label in form.pace_level.field.choices %}
            <option value="{{ level_value }}" {% if form.pace_level.value|stringformat:"s" == level_value|stringformat:"s" %}selected{% endif %}>
              {{ level_label }}
            </option>
          {% endfor %}
        </select>
        {% if form.pace_level.errors %}
          <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.pace_level.errors.0 }}</p>
        {% endif %}
      </div>

      <!-- Backdated Checkbox -->
      <div>
        <label class="flex items-center gap-3 cursor-pointer group">
          <input
            type="checkbox"
            name="{{ form.add_backdated.name }}"
            value="on"
            class="w-5 h-5 rounded text-primary bg-gray-100 dark:bg-gray-800 border-gray-300 dark:border-gray-600 focus:ring-primary"
            {% if form.add_backdated.value %}checked{% endif %}
          />
          <span class="text-sm font-medium text-gray-700 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white transition-colors">
            Add historical pace entries for {{ current_sport|lower }}
          </span>
        </label>
      </div>
    {% endif %}

    <!-- Submit Button -->
    <div class="pt-4">
      <button
        type="submit"
        class="w-full h-11 rounded-lg bg-primary text-white font-medium transition-colors hover:bg-primary/90 active:bg-primary/80"
      >
        {% if sport_index|add:"1" < total_sports %}
          Save & Continue to {{ current_sport }}
        {% else %}
          Continue to Weight Tracking
        {% endif %}
      </button>
    </div>
  </form>

  <!-- Progress Indicator for Multiple Sports -->
  {% if total_sports > 1 %}
    <div class="mt-6 text-center">
      <p class="text-sm text-gray-500 dark:text-gray-400">
        Setting up {{ current_sport }} ({{ sport_index|add:"1" }} of {{ total_sports }})
      </p>
    </div>
  {% endif %}
</div>
{% endblock %}
