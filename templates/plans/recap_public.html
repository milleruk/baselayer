{% extends "base.html" %}
{% load static %}

{% block title %}{{ username }}'s {{ selected_year }} Recap{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
  <div class="mb-6">
    <h1 class="text-3xl font-bold">{{ username }}'s {{ selected_year }} Recap</h1>
    <p class="text-gray-600 dark:text-gray-400 mt-2">ğŸ“Š Public View</p>
  </div>

  {% if not has_workouts %}
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
      <h2 class="text-xl font-semibold mb-2">No workouts found</h2>
      <p class="text-gray-600 dark:text-gray-400">No workouts found for {{ selected_year }}.</p>
    </div>
  {% else %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Summary Stats -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
        <h2 class="text-xl font-semibold mb-4">ğŸ“Š Summary</h2>
        <div class="space-y-3">
          <div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Total Workouts</div>
            <div class="text-2xl font-bold">{{ total_workouts }}</div>
          </div>
          <div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Active Days</div>
            <div class="text-2xl font-bold">{{ active_days }}</div>
          </div>
          <div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Longest Streak</div>
            <div class="text-2xl font-bold">{{ longest_streak }} days</div>
          </div>
        </div>
      </div>

      <!-- Distance & Calories -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
        <h2 class="text-xl font-semibold mb-4">ğŸ“ˆ Performance</h2>
        <div class="space-y-3">
          {% if summary_stats.total_distance_km > 0 %}
          <div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Total Distance</div>
            <div class="text-2xl font-bold">{{ summary_stats.total_distance_km }} km</div>
          </div>
          {% endif %}
          {% if summary_stats.total_calories > 0 %}
          <div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Total Calories</div>
            <div class="text-2xl font-bold">{{ summary_stats.total_calories|floatformat:0 }} cal</div>
          </div>
          {% endif %}
          {% if summary_stats.total_output_kj > 0 %}
          <div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Total Output</div>
            <div class="text-2xl font-bold">{{ summary_stats.total_output_kj }} kJ</div>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Averages -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
        <h2 class="text-xl font-semibold mb-4">ğŸ“Š Averages</h2>
        <div class="space-y-3">
          {% if summary_stats.avg_output > 0 %}
          <div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Avg Output</div>
            <div class="text-2xl font-bold">{{ summary_stats.avg_output }} W</div>
          </div>
          {% endif %}
          {% if summary_stats.avg_calories > 0 %}
          <div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Avg Calories</div>
            <div class="text-2xl font-bold">{{ summary_stats.avg_calories|floatformat:0 }} cal</div>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Top Instructors -->
      {% if top_instructors %}
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 md:col-span-2 lg:col-span-3">
        <h2 class="text-xl font-semibold mb-4">ğŸ‘¨â€ğŸ« Top Instructors</h2>
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
          {% for instructor in top_instructors %}
          <div class="text-center">
            <div class="text-lg font-semibold">{{ instructor.ride_detail__instructor__name }}</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">{{ instructor.count }} classes</div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Monthly Breakdown -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 md:col-span-2 lg:col-span-3">
        <h2 class="text-xl font-semibold mb-4">ğŸ“… Monthly Breakdown</h2>
        <div class="grid grid-cols-3 md:grid-cols-6 lg:grid-cols-12 gap-4">
          {% for month in monthly_data %}
          <div class="text-center">
            <div class="text-sm font-semibold">{{ month.month|slice:":3" }}</div>
            <div class="text-lg">{{ month.count }}</div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}
