{% extends "base.html" %}
{% load medal_tags %}
{% block title %}Performance Metrics{% endblock %}
{% block page_title %}Performance Metrics{% endblock %}

{% block content %}
<div class="mb-6">
  <h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Performance Metrics</h1>
  <p class="text-gray-600 dark:text-gray-400">Track your progress and celebrate your achievements</p>
</div>

<!-- Top Section: Personal Records and This Month -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
  <!-- Personal Records -->
  <div class="rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-6 shadow-sm">
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
      <h2 class="text-xl font-bold text-gray-900 dark:text-white">Personal Records</h2>
      <div class="flex gap-2">
        <button class="px-3 py-1.5 text-xs font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors" data-period="1">1 Month</button>
        <button class="px-3 py-1.5 text-xs font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors" data-period="2">2 Months</button>
        <button class="px-3 py-1.5 text-xs font-medium text-white bg-primary rounded-lg" data-period="3">3 Months</button>
      </div>
    </div>
    <div class="grid grid-cols-5 gap-4 mb-4">
      <div class="text-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
        <div class="text-xs text-gray-600 dark:text-gray-400 uppercase tracking-wide mb-2">1 MIN POWER</div>
        <div class="text-xl font-bold text-purple-600 dark:text-purple-400">266 W</div>
      </div>
      <div class="text-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
        <div class="text-xs text-gray-600 dark:text-gray-400 uppercase tracking-wide mb-2">3 MIN POWER</div>
        <div class="text-xl font-bold text-purple-600 dark:text-purple-400">230 W</div>
      </div>
      <div class="text-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
        <div class="text-xs text-gray-600 dark:text-gray-400 uppercase tracking-wide mb-2">5 MIN POWER</div>
        <div class="text-xl font-bold text-purple-600 dark:text-purple-400">222 W</div>
      </div>
      <div class="text-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
        <div class="text-xs text-gray-600 dark:text-gray-400 uppercase tracking-wide mb-2">10 MIN POWER</div>
        <div class="text-xl font-bold text-purple-600 dark:text-purple-400">202 W</div>
      </div>
      <div class="text-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
        <div class="text-xs text-gray-600 dark:text-gray-400 uppercase tracking-wide mb-2">20 MIN POWER</div>
        <div class="text-xl font-bold text-purple-600 dark:text-purple-400">197 W</div>
      </div>
    </div>
    <div class="p-4 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-700 rounded-lg text-sm text-gray-600 dark:text-gray-400">
      Your best power outputs across different time intervals.
    </div>
  </div>

  <!-- This Month -->
  <div class="rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-6 shadow-sm">
    <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6">This Month</h2>
    <div class="flex items-center gap-4 mb-6">
      <span class="text-sm text-gray-600 dark:text-gray-400">Discipline:</span>
      <div class="flex gap-2">
        <button class="px-3 py-1.5 text-xs font-medium text-white bg-primary rounded-lg">Cycling</button>
        <button class="px-3 py-1.5 text-xs font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">Tread</button>
      </div>
    </div>
    <div class="space-y-6">
      <div>
        <div class="text-xs text-gray-600 dark:text-gray-400 uppercase tracking-wide mb-2">Distance</div>
        <div class="flex justify-between">
          <div>
            <div class="text-xl font-bold text-gray-900 dark:text-white">28</div>
            <div class="text-xs text-gray-600 dark:text-gray-400">Monthly</div>
          </div>
          <div>
            <div class="text-xl font-bold text-gray-900 dark:text-white">28</div>
            <div class="text-xs text-gray-600 dark:text-gray-400">Yearly</div>
          </div>
        </div>
      </div>
      <div>
        <div class="text-xs text-gray-600 dark:text-gray-400 uppercase tracking-wide mb-2">Output</div>
        <div class="flex justify-between">
          <div>
            <div class="text-xl font-bold text-gray-900 dark:text-white">740</div>
            <div class="text-xs text-gray-600 dark:text-gray-400">Monthly</div>
          </div>
          <div>
            <div class="text-xl font-bold text-gray-900 dark:text-white">740</div>
            <div class="text-xs text-gray-600 dark:text-gray-400">Yearly</div>
          </div>
        </div>
      </div>
      <div>
        <div class="text-xs text-gray-600 dark:text-gray-400 uppercase tracking-wide mb-2">TSS</div>
        <div class="flex justify-between">
          <div>
            <div class="text-xl font-bold text-gray-900 dark:text-white">78</div>
            <div class="text-xs text-gray-600 dark:text-gray-400">Monthly</div>
          </div>
          <div>
            <div class="text-xl font-bold text-gray-900 dark:text-white">78</div>
            <div class="text-xs text-gray-600 dark:text-gray-400">Yearly</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Achievements & Milestones Section -->
<div class="rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-6 shadow-sm mb-8">
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
    <h2 class="text-xl font-bold text-gray-900 dark:text-white">Achievements & Milestones</h2>
    <div class="flex gap-2">
      <button class="px-4 py-2 text-sm font-medium text-white bg-primary rounded-lg metrics-tab-btn active" data-tab="achievements">Achievements</button>
      <button class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors metrics-tab-btn" data-tab="milestones">Milestones</button>
    </div>
  </div>
  
  <div id="achievements-tab" class="metrics-tab-content">
    {% if fully_completed_challenges %}
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for challenge_instance in fully_completed_challenges %}
          <div class="text-center p-6 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50">
            {% if challenge_instance.challenge.image %}
              <div class="w-20 h-20 mx-auto mb-4 rounded-lg bg-cover bg-center" style="background-image: url('{{ challenge_instance.challenge.image.url }}');"></div>
            {% else %}
              <div class="w-20 h-20 mx-auto mb-4 rounded-lg bg-gradient-to-br from-orange-400 to-orange-600 flex items-center justify-center text-3xl">
                üèÜ
              </div>
            {% endif %}
            <div class="font-bold text-gray-900 dark:text-white mb-2">{{ challenge_instance.challenge.name }}</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">
              Earned {% if challenge_instance.completed_at %}{{ challenge_instance.completed_at|date:"d/m/Y" }}{% else %}{{ challenge_instance.started_at|date:"d/m/Y" }}{% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-center py-12">
        <div class="text-5xl mb-4">üèÜ</div>
        <p class="text-gray-600 dark:text-gray-400">No achievements yet. Complete challenges to earn badges!</p>
      </div>
    {% endif %}
  </div>
  
  <div id="milestones-tab" class="metrics-tab-content hidden">
    <!-- Milestones content - keeping structure but updating styles -->
    <div class="space-y-6">
      {% for category in "Yoga,Bike,Tread,Stretching,Strength"|make_list %}
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
          <div class="flex items-center gap-3 mb-4">
            <div class="text-2xl">{% cycle "üßò" "üö¥" "üèÉ" "ü§∏" "üí™" %}</div>
            <div>
              <div class="font-semibold text-gray-900 dark:text-white">{% cycle "Yoga" "Bike" "Tread" "Stretching" "Strength" %}</div>
              <div class="text-sm text-gray-600 dark:text-gray-400">(0 workouts)</div>
            </div>
          </div>
          <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
            {% for milestone in "10+,50+,100+,500+,1000+"|make_list %}
              <div class="text-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                <div class="w-12 h-12 mx-auto mb-2 rounded-full bg-yellow-100 dark:bg-yellow-900/30 flex items-center justify-center text-xs font-bold text-yellow-800 dark:text-yellow-200">
                  {% cycle "10+" "50+" "100+" "500+" "1000+" %}
                </div>
                <div class="text-xs text-gray-600 dark:text-gray-400 mb-1">Not Completed</div>
                <div class="text-xs text-gray-700 dark:text-gray-300">{% cycle "10+" "50+" "100+" "500+" "1000+" %} {% cycle "Yoga" "Bike" "Tread" "Stretching" "Strength" %} workouts</div>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

<!-- Power to Weight, Time in Zones, Average Heartbeat -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
  <!-- Power to Weight -->
  <div class="rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-6 shadow-sm">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-bold text-gray-900 dark:text-white">Power to Weight</h3>
      <span class="text-gray-500 dark:text-gray-400 cursor-pointer">‚ÑπÔ∏è</span>
    </div>
    <div class="flex gap-2 mb-4">
      <button class="px-3 py-1.5 text-xs font-medium text-white bg-primary rounded-lg">Cycling</button>
      <button class="px-3 py-1.5 text-xs font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">Tread</button>
    </div>
    {% if current_weight %}
      <div class="mb-4">
        <div class="text-sm text-gray-600 dark:text-gray-400 mb-2">Current cycling:</div>
        <div class="px-3 py-2 text-green-800 dark:text-green-200 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg font-bold inline-block">
          {{ current_weight.weight|floatformat:2 }} lbs
        </div>
      </div>
    {% endif %}
    <div class="text-xs text-gray-600 dark:text-gray-400 uppercase tracking-wide mb-2">History</div>
    <div class="text-xs text-gray-600 dark:text-gray-400">
      Historical data will appear here once Peloton integration is connected.
    </div>
  </div>

  <!-- Time in Zones -->
  <div class="rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-6 shadow-sm">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-bold text-gray-900 dark:text-white">Time in Zones</h3>
      <a href="#" class="text-sm text-primary hover:text-primary-dark">View Details</a>
    </div>
    <div class="flex gap-2 mb-4">
      <button class="px-3 py-1.5 text-xs font-medium text-white bg-primary rounded-lg">Monthly</button>
      <button class="px-3 py-1.5 text-xs font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">Yearly</button>
    </div>
    <div class="text-center py-8 text-gray-600 dark:text-gray-400">
      <div class="text-4xl mb-2">üìä</div>
      <div class="text-sm">Zone distribution chart will appear here once Peloton data is connected.</div>
    </div>
  </div>

  <!-- Average Heartbeat -->
  <div class="rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-6 shadow-sm">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-bold text-gray-900 dark:text-white">Average Heartbeat</h3>
      <div class="flex items-center gap-2">
        <span class="text-gray-500 dark:text-gray-400 cursor-pointer">‚ÑπÔ∏è</span>
        <a href="#" class="text-sm text-primary hover:text-primary-dark">View Details</a>
      </div>
    </div>
    <div class="text-xs text-gray-600 dark:text-gray-400">
      Heart rate data will appear here once Peloton integration is connected.
    </div>
  </div>
</div>

<!-- FTP Progression -->
<div class="rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-6 shadow-sm">
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
    <h2 class="text-xl font-bold text-gray-900 dark:text-white">FTP Progression</h2>
    <div class="flex gap-2">
      <button class="px-4 py-2 text-sm font-medium text-white bg-primary rounded-lg">Trends</button>
      <button class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">Zones</button>
    </div>
  </div>
  <div class="text-center py-12 text-gray-600 dark:text-gray-400">
    <div class="text-4xl mb-2">üìà</div>
    <p>FTP progression data will appear here once Peloton integration is connected.</p>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Tab switching for Achievements/Milestones
  document.querySelectorAll('.metrics-tab-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const tabName = this.dataset.tab;
      
      // Update buttons
      document.querySelectorAll('.metrics-tab-btn').forEach(b => {
        b.classList.remove('active', 'bg-primary', 'text-white');
        b.classList.add('bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
      });
      this.classList.add('active', 'bg-primary', 'text-white');
      this.classList.remove('bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
      
      // Update content
      document.getElementById('achievements-tab').classList.toggle('hidden', tabName !== 'achievements');
      document.getElementById('milestones-tab').classList.toggle('hidden', tabName !== 'milestones');
    });
  });
  
  // Time period buttons
  document.querySelectorAll('[data-period]').forEach(btn => {
    btn.addEventListener('click', function() {
      this.parentElement.querySelectorAll('[data-period]').forEach(b => {
        b.classList.remove('bg-primary', 'text-white');
        b.classList.add('bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
      });
      this.classList.add('bg-primary', 'text-white');
      this.classList.remove('bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
    });
  });
});
</script>
{% endblock %}
