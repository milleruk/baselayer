# Visual Architecture: Simplified Class Search

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ADMIN BROWSER                            â”‚
â”‚  /challenges/admin/{challenge_id}/assign-workouts/              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  ğŸ” Search Field      â”‚
     â”‚  (Single input box)   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ (user types: "power zone", 300ms debounce)
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚    JavaScript: addClassSearch()           â”‚
     â”‚  - Debounces input (300ms)               â”‚
     â”‚  - Validates: q.length >= 2              â”‚
     â”‚  - Fetches: /api/search-classes/?q=...  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ AJAX Request (no external APIs)
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Django Backend: search_ride_classes()   â”‚
     â”‚  âœ“ Authenticates (@login_required)       â”‚
     â”‚  âœ“ Authorizes (is_admin check)           â”‚
     â”‚  1. Try exact ID match (fastest)         â”‚
     â”‚  2. Try title partial match              â”‚
     â”‚  3. Apply activity filter                â”‚
     â”‚  4. Return top 10 results                â”‚
     â”‚  5. Include has_chart indicator          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚    Database Query: RideDetail             â”‚
     â”‚  - peloton_ride_id (indexed)             â”‚
     â”‚  - title (indexed)                       â”‚
     â”‚  - fitness_discipline                    â”‚
     â”‚  - target_metrics_data (has chart?)      â”‚
     â”‚  - instructor name                       â”‚
     â”‚  - duration_minutes                      â”‚
     â”‚  - difficulty_level                      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚    JSON Response: {results: [...]}       â”‚
     â”‚  [{                                      â”‚
     â”‚    id: 2411,                             â”‚
     â”‚    peloton_id: "97d1457e...",            â”‚
     â”‚    title: "45 min Power Zone...",        â”‚
     â”‚    discipline: "Cycling",                â”‚
     â”‚    instructor: "Erik JÃ¤ger",             â”‚
     â”‚    duration: 45,                         â”‚
     â”‚    difficulty: "N/A",                    â”‚
     â”‚    has_chart: true  â† ğŸ“Š INDICATOR      â”‚
     â”‚  }]                                      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  JavaScript: Render Dropdown             â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
     â”‚  â”‚ ğŸ“Š 45 min Power Zone Endurance...   â”‚ â”‚ â† ğŸ“Š if has_chart
     â”‚  â”‚    Erik JÃ¤ger â€¢ 45min              â”‚ â”‚
     â”‚  â”‚                                     â”‚ â”‚
     â”‚  â”‚ âœ“ 30 min Flow Yoga                 â”‚ â”‚ â† No ğŸ“Š if no chart
     â”‚  â”‚    Aditi Shah â€¢ 30min              â”‚ â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ (user clicks a result)
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  JavaScript: selectWorkout()             â”‚
     â”‚  1. Create hidden ride_id_* field        â”‚
     â”‚  2. Set value = ride.id                  â”‚
     â”‚  3. Update search field visual:          â”‚
     â”‚     - Border: green                      â”‚
     â”‚     - Icon: ğŸ“Š or âœ“                      â”‚
     â”‚     - Text: Class title                  â”‚
     â”‚  4. Hide dropdown                        â”‚
     â”‚  5. Call updateStats()                   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚    Form Display Update                   â”‚
     â”‚  ğŸ“Š 45 min Power Zone Endurance [âœ“]      â”‚
     â”‚     â†‘                            â†‘       â”‚
     â”‚     Green border               Selected  â”‚
     â”‚                                          â”‚
     â”‚  [Hidden] ride_id_* = 2411               â”‚
     â”‚  [Hidden] workout_* = populated by form  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ (user clicks Save)
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚    Form Submission: POST                 â”‚
     â”‚  - ride_id_* = 2411                      â”‚
     â”‚  - workout_* = (URL field - optional)    â”‚
     â”‚  - title_* = (title field - optional)    â”‚
     â”‚  - points_* = 50                         â”‚
     â”‚  - csrf_token                            â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Django: admin_assign_workouts()         â”‚
     â”‚  1. Get ride_id from POST                â”‚
     â”‚  2. Lookup: RideDetail.objects.get(id)   â”‚
     â”‚  3. Auto-populate:                       â”‚
     â”‚     - peloton_url from library           â”‚
     â”‚     - workout_title from library         â”‚
     â”‚  4. Create ChallengeWorkoutAssignment    â”‚
     â”‚  5. Set ride_detail FK                   â”‚
     â”‚  6. Save to database                     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚    Database: Saved                       â”‚
     â”‚  ChallengeWorkoutAssignment              â”‚
     â”‚  {                                       â”‚
     â”‚    challenge_id: 74,                     â”‚
     â”‚    template_id: 5,                       â”‚
     â”‚    week_number: 1,                       â”‚
     â”‚    day_of_week: 3,                       â”‚
     â”‚    activity_type: 'ride',                â”‚
     â”‚    ride_detail_id: 2411,   â† LINKED!   â”‚
     â”‚    peloton_url: "https://...",           â”‚
     â”‚    workout_title: "45 min Power Zone...", â”‚
     â”‚    points: 50                            â”‚
     â”‚  }                                       â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow: Search to Selection

```
STEP 1: User Input
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User types: "power zone"             â”‚
â”‚ â†“                                    â”‚
â”‚ JavaScript captures 'input' event    â”‚
â”‚ â†“                                    â”‚
â”‚ Debounce: Wait 300ms for more input  â”‚
â”‚ â†“                                    â”‚
â”‚ Check: q.length >= 2 âœ“               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 2: API Call
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ fetch('/challenges/api/search-      â”‚
â”‚   classes/?q=power+zone&             â”‚
â”‚   activity=ride')                    â”‚
â”‚ â†“                                    â”‚
â”‚ Request Headers:                     â”‚
â”‚ - User: Authenticated                â”‚
â”‚ - Method: GET                        â”‚
â”‚ - Content-Type: application/json     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 3: Database Search
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Query 1: ID Exact Match              â”‚
â”‚ WHERE peloton_ride_id = 'power zone' â”‚
â”‚ Result: No match (not an ID)         â”‚
â”‚ â†“                                    â”‚
â”‚ Query 2: Title Partial Match         â”‚
â”‚ WHERE title ILIKE '%power zone%'     â”‚
â”‚ Result: 5 matches found âœ“            â”‚
â”‚ â†“                                    â”‚
â”‚ Query 3: Activity Filter (if any)    â”‚
â”‚ WHERE fitness_discipline = 'cycling' â”‚
â”‚ Result: 3 remaining âœ“                â”‚
â”‚ â†“                                    â”‚
â”‚ Query 4: Add Chart Data              â”‚
â”‚ Check: target_metrics_data           â”‚
â”‚ Result: 2 have charts, 1 doesn't     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 4: JSON Response
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {                                    â”‚
â”‚   "results": [                       â”‚
â”‚     {                                â”‚
â”‚       "id": 2411,                    â”‚
â”‚       "title": "45 min Power Zone...",
â”‚       "has_chart": true,    â† ğŸ“Š   â”‚
â”‚       ...                            â”‚
â”‚     },                               â”‚
â”‚     {                                â”‚
â”‚       "id": 2412,                    â”‚
â”‚       "title": "30 min Power Zone...",
â”‚       "has_chart": true,    â† ğŸ“Š   â”‚
â”‚       ...                            â”‚
â”‚     },                               â”‚
â”‚     {                                â”‚
â”‚       "id": 2413,                    â”‚
â”‚       "title": "Power Zone Class",   â”‚
â”‚       "has_chart": false,   â† âœ“    â”‚
â”‚       ...                            â”‚
â”‚     }                                â”‚
â”‚   ]                                  â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 5: Render UI
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Dropdown Item 1:                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“Š 45 min Power Zone Endurance  â”‚ â”‚
â”‚ â”‚    Erik JÃ¤ger â€¢ 45min           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚
â”‚ Dropdown Item 2:                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“Š 30 min Power Zone Climb       â”‚ â”‚
â”‚ â”‚    Olivia Amato â€¢ 30min         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚
â”‚ Dropdown Item 3:                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âœ“ Power Zone Class               â”‚ â”‚
â”‚ â”‚   Unknown â€¢ 45min                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 6: User Selection
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User clicks: Item 1 (45 min PZ)      â”‚
â”‚ â†“                                    â”‚
â”‚ selectWorkout() executes:            â”‚
â”‚ 1. ride_id_* = 2411                  â”‚
â”‚ 2. searchInput.value = "ğŸ“Š 45 min PZ"â”‚
â”‚ 3. border-green-500 applied          â”‚
â”‚ 4. dropdown.hidden = true             â”‚
â”‚ 5. updateStats() called              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 7: Form Display
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Search Field (now filled):           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“Š 45 min Power Zone Endurance  â”‚ â† Green border
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚
â”‚ Hidden Fields (set):                 â”‚
â”‚ ride_id_template_week_day_ride = 2411â”‚
â”‚                                      â”‚
â”‚ Original URL Field (still there):    â”‚
â”‚ [Empty or with manual URL]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 8: Form Submission
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User clicks: Save Assignments        â”‚
â”‚ â†“                                    â”‚
â”‚ Django Receives:                     â”‚
â”‚ - ride_id_* = 2411                   â”‚
â”‚ - workout_* = (empty or manual URL)  â”‚
â”‚ - title_* = (empty or manual title)  â”‚
â”‚ - points_* = 50                      â”‚
â”‚ â†“                                    â”‚
â”‚ Backend Processing:                  â”‚
â”‚ 1. Get ride_id: 2411                 â”‚
â”‚ 2. Lookup RideDetail by ID           â”‚
â”‚ 3. Get URL from RideDetail           â”‚
â”‚ 4. Get title from RideDetail         â”‚
â”‚ 5. Create ChallengeWorkoutAssignment â”‚
â”‚ 6. Set ride_detail FK = 2411         â”‚
â”‚ â†“                                    â”‚
â”‚ Result: âœ“ Saved with ride_detail FK  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± UI State Transitions

```
Initial State:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” Search by title or class ID...  â”‚  â† Placeholder
â”‚                                     â”‚
â”‚ [Hidden: ride_id_* = empty]         â”‚
â”‚ [Hidden: workout_* = empty]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ (user starts typing)

Typing State:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” power                            â”‚  â† User input
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“Š 45 min Power Zone Endurance  â”‚ â”‚
â”‚ â”‚ ğŸ“Š 30 min Power Zone Climb      â”‚ â”‚
â”‚ â”‚ âœ“ Power Zone Basics             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â† Dropdown open
â”‚ [Hidden: ride_id_* = empty]         â”‚
â”‚ [Hidden: workout_* = empty]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ (user clicks result)

Selected State:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š 45 min Power Zone Endurance  âœ“   â”‚  â† Confirmed!
â”‚                                     â”‚  â† Green border
â”‚ [Hidden: ride_id_* = 2411]          â”‚  â† Set!
â”‚ [Hidden: workout_* = empty/URL]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ (user saves form)

Saved State:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database: ChallengeWorkoutAssignmentâ”‚
â”‚ {                                   â”‚
â”‚   ride_detail_id: 2411,             â”‚  â† FK Linked!
â”‚   peloton_url: "https://...",       â”‚  â† Auto-filled
â”‚   workout_title: "45 min Power...", â”‚  â† Auto-filled
â”‚   points: 50                        â”‚
â”‚ }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Search Priority Logic

```
Query: "power zone"

Step 1: Try Exact ID Match
  WHERE peloton_ride_id = 'power zone'
  Result: âˆ… (not an ID)
  â†’ Continue

Step 2: Try Title Match
  WHERE title ILIKE '%power zone%'
  Result: âœ“ Found 5 classes
  â†’ Return results

Final Result:
- 45 min Power Zone Endurance (has chart: ğŸ“Š)
- 30 min Power Zone Climb (has chart: ğŸ“Š)
- Power Zone Basics (no chart: âœ“)
- ... (limited to 10 max)

--------

Query: "97d1457e42d847cb97727e5cc0e6b958"

Step 1: Try Exact ID Match
  WHERE peloton_ride_id IEXACT = '97d1457e...'
  Result: âœ“ Found 1 class
  â†’ Return immediately (fastest)

Final Result:
- 45 min Power Zone Endurance Ride (exact match, has chart: ğŸ“Š)
```

---

## ğŸ’¾ Database State After Save

```
Before Selection:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChallengeWorkoutAssignment:         â”‚
â”‚ {                                   â”‚
â”‚   challenge_id: 74,                 â”‚
â”‚   template_id: 5,                   â”‚
â”‚   week_number: 1,                   â”‚
â”‚   day_of_week: 3,                   â”‚
â”‚   activity_type: 'ride',            â”‚
â”‚   ride_detail_id: NULL,             â”‚ â† Not linked
â”‚   peloton_url: NULL,                â”‚ â† Empty
â”‚   workout_title: NULL,              â”‚ â† Empty
â”‚   points: NULL                      â”‚ â† Empty
â”‚ }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After Search & Selection:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User selects: RideDetail #2411      â”‚
â”‚ (45 min Power Zone Endurance)       â”‚
â”‚                                     â”‚
â”‚ Hidden field set:                   â”‚
â”‚ ride_id_5_1_3_ride = 2411           â”‚
â”‚                                     â”‚
â”‚ Form submitted...                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After Form Submission:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChallengeWorkoutAssignment:         â”‚
â”‚ {                                   â”‚
â”‚   challenge_id: 74,                 â”‚
â”‚   template_id: 5,                   â”‚
â”‚   week_number: 1,                   â”‚
â”‚   day_of_week: 3,                   â”‚
â”‚   activity_type: 'ride',            â”‚
â”‚   ride_detail_id: 2411,             â”‚ â† âœ“ LINKED!
â”‚   peloton_url: "https://www...",    â”‚ â† Auto-filled
â”‚   workout_title: "45 min Power...", â”‚ â† Auto-filled
â”‚   points: 50                        â”‚ â† Default
â”‚ }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Why This Matters:
âœ“ No more data duplication
âœ“ Instructor info available
âœ“ Metrics already synced
âœ“ Updates propagate automatically
âœ“ Single source of truth
```

---

**Architecture Status:** âœ… COMPLETE
**Code Status:** âœ… TESTED
**Documentation Status:** âœ… COMPREHENSIVE
**Ready for:** DEPLOYMENT
